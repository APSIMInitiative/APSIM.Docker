pipeline {
	agent none
    stages {
		stage('BuildAndRun') {
			agent {
				label "windows && docker"
			}
			steps {
				bat '''
					@echo off
					echo dir=%cd%
					echo jenkinsfile location=%~dp0
					docker build -m 12g -t buildapsim %~dp0
					if errorlevel 1 (
						echo Encountered an error while building docker container. Exiting...
						exit 1
					)
					docker run -m 12g buildapsim
				'''
			}
		}
    }
}